<h1>Mapping Incoming Attacks on Microsoft Azure</h1>

<h2>Description</h2>
This project consists of setting up a VM, configuring Log Analytics Workspace, and configuring a Sentinel workbook in Microsoft Azure. The end result is a map that displays the geolocation of incoming RDP brute force attacks on a world map.
<br />

<h2>Tools Used</h2>

- <b>Microsoft Azure</b>
- <b>PowerShell</b>
- <b><a href="https://ipgeolocation.io">ipgeolocation</a></b>

<h2>Project demonstration:</h2>
<p align="center"><img width="1146" alt="Untitled1" src="https://github.com/chau-eric/honeypot/assets/76719902/f232c1bf-dc42-4a0c-bd30-99b0689aec4b">
</p>
World map of incoming attacks after a few hours. Metrics along the bottom represent the number of attacks from each IP.
<br/>
<h2>VM setup</h2>
The virtual machine receiving all of the attacks is a Windows 10 Pro VM setup in Microsoft Azure. It has a custom inbound port rule to allow all traffic from the internet into the VM.
<p align="center"><img width="424" alt="Untitled1" src="https://github.com/chau-eric/honeypot/assets/76719902/791be08f-4846-4d65-95f4-68463a5db0c7">
</p>
Windows Defender Firewall is also turned off on the VM. The purpose of all this is to make the machine very discoverable from methods such as ICMP echo requests or any other method that may have its traffic dropped. This is done to increase the chances of the machine being attacked.
<h2>Logs</h2>
Azure's Log Analytics Workspaces is used to ingest custom logs from the VM created in the previous step. These logs are generated by the PowerShell script (credit to Josh Madakor) and contain geographic information that is used to plot data on the world map. The PowerShell script looks through the Windows Security Event logs for Event 4625, which identifies a failed log on attempt. Failed log on attempts are used as the indicator for an RDP brute force attack. The script will then use the source IP addresses on <a href="https://ipgeolocation.io">ipgeolocation's API</a> to receive the attacker's latitude, longitude, state/province, city, and country. It will then output this information to a new logfile, C:\ProgramData\failed_rdp.log. A custom log is created in Log Analytics Workspaces to collect from this path on the VM.
